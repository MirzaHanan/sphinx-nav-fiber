import{g as Ae,a as Re,s as se,_,a9 as Bt,r as y,b as Le,j as s,d as _e,c as ne,e as Ie,u as yt,aM as Ft,b4 as ve,b5 as ze,a7 as rt,b6 as Vt,b7 as Yt,a0 as Ut,f as W,F as C,h as F,D as Ne,a_ as Gt,T as te,B as wt,N as we,aY as fe,a$ as Wt,b8 as Ht,b9 as Zt,ba as Kt,Z as N,bb as ie,bc as ae,ap as it,bd as be,be as xe,bf as at,bg as H,bh as Xt,ar as qt,bi as ct,bj as lt,bk as dt,bl as ut,bm as Qt,am as Jt,W as eo,bn as to}from"./index-2b2e50af.js";import{B as oo}from"./index-8896a668.js";import{q as no,r as so,i as ro,C as Be,I as io,B as Fe,c as ao,b as co,F as lo,s as uo}from"./react-toastify.esm-52859160.js";import{e as po,A as Se}from"./index-3ffb6a3e.js";import{T as De}from"./index-f05ece84.js";import{c as pt,d as fo}from"./index-93089e64.js";import{D as ho,P as mo}from"./PlusIcon-d1601319.js";import{p as go,c as bo}from"./index-30d16895.js";import{u as xo}from"./Popover-823961c6.js";import{u as yo}from"./index-977471e7.js";import{L as wo,m as vo,u as Q,b as je,T as jo,C as Eo}from"./constant-bc2198f0.js";import{f as ko,P as Po,L as Co}from"./constants-cb2fbe68.js";import{A as To}from"./AddContentIcon-7675d8c5.js";import"./useSlotProps-e8abd4ce.js";import"./Popper-f57666da.js";import"./index.esm-12a2c494.js";import"./InfoIcon-e1d5caeb.js";import"./generateCategoricalChart-c21aaf4b.js";import"./NoFilterResultIcon-715405e8.js";import"./index-6f897188.js";import"./index-454446ef.js";import"./CheckIcon-08ead1a9.js";function Oo(t){return Ae("PrivateSwitchBase",t)}Re("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Mo=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],$o=t=>{const{classes:o,checked:i,disabled:e,edge:a}=t,c={root:["root",i&&"checked",e&&"disabled",a&&`edge${ne(a)}`],input:["input"]};return Ie(c,Oo,o)},No=se(no)(({ownerState:t})=>_({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),So=se("input",{shouldForwardProp:Bt})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Do=y.forwardRef(function(o,i){const{autoFocus:e,checked:a,checkedIcon:c,className:p,defaultChecked:r,disabled:u,disableFocusRipple:g=!1,edge:l=!1,icon:f,id:h,inputProps:j,inputRef:T,name:m,onBlur:v,onChange:w,onFocus:S,readOnly:R,required:M=!1,tabIndex:k,type:A,value:U}=o,D=Le(o,Mo),[I,E]=yo({controlled:a,default:!!r,name:"SwitchBase",state:"checked"}),V=xo(),re=G=>{S&&S(G),V&&V.onFocus&&V.onFocus(G)},J=G=>{v&&v(G),V&&V.onBlur&&V.onBlur(G)},P=G=>{if(G.nativeEvent.defaultPrevented)return;const le=G.target.checked;E(le),w&&w(G,le)};let $=u;V&&typeof $>"u"&&($=V.disabled);const z=A==="checkbox"||A==="radio",B=_({},o,{checked:I,disabled:$,disableFocusRipple:g,edge:l}),Z=$o(B);return s.jsxs(No,_({component:"span",className:_e(Z.root,p),centerRipple:!0,focusRipple:!g,disabled:$,tabIndex:null,role:void 0,onFocus:re,onBlur:J,ownerState:B,ref:i},D,{children:[s.jsx(So,_({autoFocus:e,checked:a,defaultChecked:r,className:Z.input,disabled:$,id:z?h:void 0,name:m,onChange:P,readOnly:R,ref:T,required:M,ownerState:B,tabIndex:k,type:A},A==="checkbox"&&U===void 0?{}:{value:U},j)),I?c:f]}))}),Ao=Do,Ro=y.createContext(),ft=Ro;function Lo(t){return Ae("MuiGrid",t)}const _o=[0,1,2,3,4,5,6,7,8,9,10],Io=["column-reverse","column","row-reverse","row"],zo=["nowrap","wrap-reverse","wrap"],pe=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Bo=Re("MuiGrid",["root","container","item","zeroMinWidth",..._o.map(t=>`spacing-xs-${t}`),...Io.map(t=>`direction-xs-${t}`),...zo.map(t=>`wrap-xs-${t}`),...pe.map(t=>`grid-xs-${t}`),...pe.map(t=>`grid-sm-${t}`),...pe.map(t=>`grid-md-${t}`),...pe.map(t=>`grid-lg-${t}`),...pe.map(t=>`grid-xl-${t}`)]),he=Bo,Fo=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function ce(t){const o=parseFloat(t);return`${o}${String(t).replace(String(o),"")||"px"}`}function Vo({theme:t,ownerState:o}){let i;return t.breakpoints.keys.reduce((e,a)=>{let c={};if(o[a]&&(i=o[a]),!i)return e;if(i===!0)c={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(i==="auto")c={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const p=ve({values:o.columns,breakpoints:t.breakpoints.values}),r=typeof p=="object"?p[a]:p;if(r==null)return e;const u=`${Math.round(i/r*1e8)/1e6}%`;let g={};if(o.container&&o.item&&o.columnSpacing!==0){const l=t.spacing(o.columnSpacing);if(l!=="0px"){const f=`calc(${u} + ${ce(l)})`;g={flexBasis:f,maxWidth:f}}}c=_({flexBasis:u,flexGrow:0,maxWidth:u},g)}return t.breakpoints.values[a]===0?Object.assign(e,c):e[t.breakpoints.up(a)]=c,e},{})}function Yo({theme:t,ownerState:o}){const i=ve({values:o.direction,breakpoints:t.breakpoints.values});return ze({theme:t},i,e=>{const a={flexDirection:e};return e.indexOf("column")===0&&(a[`& > .${he.item}`]={maxWidth:"none"}),a})}function vt({breakpoints:t,values:o}){let i="";Object.keys(o).forEach(a=>{i===""&&o[a]!==0&&(i=a)});const e=Object.keys(t).sort((a,c)=>t[a]-t[c]);return e.slice(0,e.indexOf(i))}function Uo({theme:t,ownerState:o}){const{container:i,rowSpacing:e}=o;let a={};if(i&&e!==0){const c=ve({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=vt({breakpoints:t.breakpoints.values,values:c})),a=ze({theme:t},c,(r,u)=>{var g;const l=t.spacing(r);return l!=="0px"?{marginTop:`-${ce(l)}`,[`& > .${he.item}`]:{paddingTop:ce(l)}}:(g=p)!=null&&g.includes(u)?{}:{marginTop:0,[`& > .${he.item}`]:{paddingTop:0}}})}return a}function Go({theme:t,ownerState:o}){const{container:i,columnSpacing:e}=o;let a={};if(i&&e!==0){const c=ve({values:e,breakpoints:t.breakpoints.values});let p;typeof c=="object"&&(p=vt({breakpoints:t.breakpoints.values,values:c})),a=ze({theme:t},c,(r,u)=>{var g;const l=t.spacing(r);return l!=="0px"?{width:`calc(100% + ${ce(l)})`,marginLeft:`-${ce(l)}`,[`& > .${he.item}`]:{paddingLeft:ce(l)}}:(g=p)!=null&&g.includes(u)?{}:{width:"100%",marginLeft:0,[`& > .${he.item}`]:{paddingLeft:0}}})}return a}function Wo(t,o,i={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[i[`spacing-xs-${String(t)}`]];const e=[];return o.forEach(a=>{const c=t[a];Number(c)>0&&e.push(i[`spacing-${a}-${String(c)}`])}),e}const Ho=se("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:i}=t,{container:e,direction:a,item:c,spacing:p,wrap:r,zeroMinWidth:u,breakpoints:g}=i;let l=[];e&&(l=Wo(p,g,o));const f=[];return g.forEach(h=>{const j=i[h];j&&f.push(o[`grid-${h}-${String(j)}`])}),[o.root,e&&o.container,c&&o.item,u&&o.zeroMinWidth,...l,a!=="row"&&o[`direction-xs-${String(a)}`],r!=="wrap"&&o[`wrap-xs-${String(r)}`],...f]}})(({ownerState:t})=>_({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),Yo,Uo,Go,Vo);function Zo(t,o){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const i=[];return o.forEach(e=>{const a=t[e];if(Number(a)>0){const c=`spacing-${e}-${String(a)}`;i.push(c)}}),i}const Ko=t=>{const{classes:o,container:i,direction:e,item:a,spacing:c,wrap:p,zeroMinWidth:r,breakpoints:u}=t;let g=[];i&&(g=Zo(c,u));const l=[];u.forEach(h=>{const j=t[h];j&&l.push(`grid-${h}-${String(j)}`)});const f={root:["root",i&&"container",a&&"item",r&&"zeroMinWidth",...g,e!=="row"&&`direction-xs-${String(e)}`,p!=="wrap"&&`wrap-xs-${String(p)}`,...l]};return Ie(f,Lo,o)},Xo=y.forwardRef(function(o,i){const e=yt({props:o,name:"MuiGrid"}),{breakpoints:a}=Ft(),c=po(e),{className:p,columns:r,columnSpacing:u,component:g="div",container:l=!1,direction:f="row",item:h=!1,rowSpacing:j,spacing:T=0,wrap:m="wrap",zeroMinWidth:v=!1}=c,w=Le(c,Fo),S=j||T,R=u||T,M=y.useContext(ft),k=l?r||12:M,A={},U=_({},w);a.keys.forEach(E=>{w[E]!=null&&(A[E]=w[E],delete U[E])});const D=_({},c,{columns:k,container:l,direction:f,item:h,rowSpacing:S,columnSpacing:R,wrap:m,zeroMinWidth:v,spacing:T},A,{breakpoints:a.keys}),I=Ko(D);return s.jsx(ft.Provider,{value:k,children:s.jsx(Ho,_({ownerState:D,className:_e(I.root,p),as:g,ref:i},U))})}),oe=Xo;function qo(t){return Ae("MuiSwitch",t)}const Qo=Re("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),Y=Qo,Jo=["className","color","edge","size","sx"],en=t=>{const{classes:o,edge:i,size:e,color:a,checked:c,disabled:p}=t,r={root:["root",i&&`edge${ne(i)}`,`size${ne(e)}`],switchBase:["switchBase",`color${ne(a)}`,c&&"checked",p&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},u=Ie(r,qo,o);return _({},o,u)},tn=se("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,o)=>{const{ownerState:i}=t;return[o.root,i.edge&&o[`edge${ne(i.edge)}`],o[`size${ne(i.size)}`]]}})(({ownerState:t})=>_({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${Y.thumb}`]:{width:16,height:16},[`& .${Y.switchBase}`]:{padding:4,[`&.${Y.checked}`]:{transform:"translateX(16px)"}}})),on=se(Ao,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,o)=>{const{ownerState:i}=t;return[o.switchBase,{[`& .${Y.input}`]:o.input},i.color!=="default"&&o[`color${ne(i.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${Y.checked}`]:{transform:"translateX(20px)"},[`&.${Y.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${Y.checked} + .${Y.track}`]:{opacity:.5},[`&.${Y.disabled} + .${Y.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${Y.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:o})=>_({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:rt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},o.color!=="default"&&{[`&.${Y.checked}`]:{color:(t.vars||t).palette[o.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[o.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:rt(t.palette[o.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Y.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${o.color}DisabledColor`]:`${t.palette.mode==="light"?Vt(t.palette[o.color].main,.62):Yt(t.palette[o.color].main,.55)}`}},[`&.${Y.checked} + .${Y.track}`]:{backgroundColor:(t.vars||t).palette[o.color].main}})),nn=se("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,o)=>o.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),sn=se("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,o)=>o.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),rn=y.forwardRef(function(o,i){const e=yt({props:o,name:"MuiSwitch"}),{className:a,color:c="primary",edge:p=!1,size:r="medium",sx:u}=e,g=Le(e,Jo),l=_({},e,{color:c,edge:p,size:r}),f=en(l),h=s.jsx(sn,{className:f.thumb,ownerState:l});return s.jsxs(tn,{className:_e(f.root,a),sx:u,ownerState:l,children:[s.jsx(on,_({type:"checkbox",icon:h,checkedIcon:h,ref:i,ownerState:l},g,{classes:_({},f,{root:f.switchBase})})),s.jsx(nn,{className:f.track,ownerState:l})]})}),an=rn,cn={schemas:[],links:[]},jt=Ut(t=>({...cn,setSchemas:o=>{t({schemas:o})},setSchemaLinks:o=>{t({links:o})}})),ln=/^[a-z0-9_]+$/,dn=({parentParam:t})=>{const[o,i]=y.useState(!1),[e,a]=y.useState([]),{fields:c,append:p,replace:r,remove:u}=so({name:"attributes"}),{setValue:g,watch:l}=ro();return y.useEffect(()=>{const f=async()=>{try{let h=[{required:!1,type:"string",key:""}];if(t!==fo.value.toLowerCase()){i(!0);const j=await Gt(t);h=go(j)}h=h.filter(j=>j.key!=="node_key"),r(h),a(h)}catch(h){console.warn(h)}finally{i(!1)}};e.length===0&&f()},[t,g,r,e.length]),s.jsxs(s.Fragment,{children:[o?s.jsx(C,{align:"center",children:s.jsx(Be,{color:F.SECONDARY_BLUE,size:"30"})}):s.jsx(un,{py:8,children:s.jsx(oe,{container:!0,spacing:2,children:c.map((f,h)=>{const j=l(`attributes[${h}].type`),T=l(`attributes[${h}].required`),m=f.isNew||!1,v=["name"].includes(l(`attributes[${h}].key`));return s.jsxs(y.Fragment,{children:[s.jsx(oe,{item:!0,xs:5,children:s.jsx(De,{autoComplete:"off",className:"text-input",disabled:!m,id:"cy-item-name",maxLength:50,name:`attributes.${h}.key`,placeholder:"Enter value",rules:{...Ne,pattern:{message:"Please avoid special characters, spaces and uppercase",value:ln}}})}),s.jsx(oe,{item:!0,xs:4,children:s.jsx(Se,{disabled:v,onSelect:w=>g(`attributes[${h}].type`,w==null?void 0:w.value),options:pt,selectedValue:pt.find(w=>w.value===j)})}),s.jsxs(oe,{item:!0,xs:3,children:[s.jsx(an,{checked:T,disabled:v,name:`attributes.${h}.required`,onChange:w=>g(`attributes[${h}].required`,w.target.checked),size:"small"}),!v&&s.jsx(io,{onClick:()=>u(h),children:s.jsx(ho,{})})]})]},f.id)})})}),s.jsx(C,{align:"flex-start",py:12,children:s.jsx(Fe,{onClick:()=>p({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:s.jsx(mo,{}),variant:"contained",children:"Add Attribute"})})]})},un=W(C)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,pn=({parent:t})=>{const o=t;return s.jsxs(C,{children:[s.jsx(C,{direction:"row",mb:10,children:s.jsxs(oe,{container:!0,spacing:2,children:[s.jsx(oe,{item:!0,xs:5,children:s.jsx(Oe,{style:{marginRight:180},children:"Attributes"})}),s.jsx(oe,{item:!0,xs:4,children:s.jsx(Oe,{style:{marginRight:130},children:"Type"})}),s.jsx(oe,{item:!0,xs:3,children:s.jsx(Oe,{children:"Required"})})]})}),o&&s.jsx(dn,{parentParam:o},o)]})},Oe=W(te)`
  font-size: 15px;
  color: gray;
`,ht={type:"",parent:""},fn=async(t,o=!1)=>{try{const{attributes:i,...e}=t,a={...e,attributes:bo(i)};let c;if(o?c=await we.put("/schema",JSON.stringify(a),{}):c=await we.post("/schema",JSON.stringify({...a,node_key:"name"}),{}),c.status!=="success")throw new Error("error");return c==null?void 0:c.ref_id}catch(i){let e=fe;if(i.status===400){const a=await i.json();e=a.errorCode||(a==null?void 0:a.status)||fe}else i instanceof Error&&(e=i.message);throw new Error(e)}},hn=({onSchemaCreate:t,selectedSchema:o,onDelete:i,setSelectedSchemaId:e,setIsCreateNew:a})=>{const{close:c,visible:p}=wt("addType"),r=ao({mode:"onChange",defaultValues:o?{type:o.type,parent:o.parent}:ht}),{watch:u,setValue:g,reset:l}=r,[f,h]=y.useState(!1),[j,T]=y.useState(!1),[m,v]=y.useState(null),[w,S]=y.useState(!1),[R,M]=y.useState(null),[k,A]=y.useState(null);y.useEffect(()=>()=>{l()},[p,l]);const U=()=>{a(!1),e("")},D=P=>P.charAt(0).toUpperCase()+P.slice(1);y.useEffect(()=>{o||(async()=>{T(!0);try{const z=(await Wt()).schemas.filter(B=>!B.is_deleted&&B.type).map(B=>(B==null?void 0:B.type)==="thing"?{label:"No Parent",value:B.type}:{label:D(B.type),value:B.type});v(z)}catch($){console.warn($)}finally{T(!1)}})()},[o]),y.useEffect(()=>{if(o){g("type",o==null?void 0:o.type),g("parent",o.parent);const P=[{label:o.parent?D(o.parent):"No Parent",value:o.parent}];A(P)}else l(ht)},[o,g,l]);const I=u("parent"),E=()=>{c()},V=async()=>{if(o!=null&&o.type)try{await we.delete(`/schema/${o.ref_id}`),i(o.type),c()}catch(P){let $=fe;if((P==null?void 0:P.status)===400){const z=await P.json();$=z.errorCode||(z==null?void 0:z.status)||fe}else P instanceof Error&&($=P.message);M($)}finally{a(!1)}},re=r.handleSubmit(async P=>{if(!I){S(!0);return}h(!1);try{P.type!==(o==null?void 0:o.type)&&await we.put(`/schema/${o==null?void 0:o.ref_id}`,JSON.stringify({type:P.type}));const $=await fn({...P,...o?{ref_id:o==null?void 0:o.ref_id}:{}},!!o);t({type:P.type,parent:I||"",ref_id:(o==null?void 0:o.ref_id)||$||"new"}),E()}catch($){if(($==null?void 0:$.status)===400){const z=await $.json();z.errorCode||z!=null&&z.status||fe}else $ instanceof Error&&$.message}finally{h(!1),a(!1)}}),J=()=>m==null?void 0:m.find(P=>P.value===I);return s.jsxs(C,{children:[s.jsx(C,{direction:"row",justify:"flex-end",children:s.jsx(gn,{"data-testid":"close-sidebar-sub-view",onClick:U,children:s.jsx(co,{})})}),s.jsx(C,{children:s.jsx(lo,{...r,children:s.jsxs("form",{id:"add-type-form",onSubmit:re,children:[s.jsx(C,{children:o?s.jsxs(s.Fragment,{children:[s.jsxs(C,{mb:12,children:[s.jsx(C,{mb:12,children:s.jsx(te,{children:"Name"})}),s.jsx(C,{mb:12,children:s.jsx(De,{defaultValue:o==null?void 0:o.type,id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Ne},value:I})})]}),s.jsxs(C,{mb:12,children:[s.jsx(C,{mb:12,children:s.jsx(te,{children:"Parent"})}),s.jsx(Se,{isLoading:j,onSelect:P=>{g("parent",(P==null?void 0:P.value)||""),S(!1)},options:k||[],selectedValue:m==null?void 0:m.find(P=>P.label===(o==null?void 0:o.parent))}),w&&s.jsx(Me,{children:"A parent type must be selected"})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs(C,{mb:12,children:[s.jsx(C,{mb:12,children:s.jsx(te,{children:"Select Parent"})}),s.jsx(Se,{isLoading:j,onSelect:P=>{g("parent",(P==null?void 0:P.value)||""),S(!1)},options:m,selectedValue:J()}),w&&s.jsx(Me,{children:"A parent type must be selected"})]}),s.jsxs(C,{children:[s.jsx(C,{mb:12,children:s.jsx(te,{children:"Type name"})}),s.jsx(C,{mb:12,children:s.jsx(De,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...Ne},value:I})})]})]})}),s.jsx(pn,{parent:o?o.type:I}),s.jsxs(C,{direction:"row",justify:"space-between",mt:20,children:[o?s.jsxs(C,{direction:"column",children:[s.jsx(mn,{color:"secondary",onClick:V,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}),R&&s.jsx(Me,{children:R})]}):null,s.jsx(Fe,{color:"secondary",disabled:f||w,onClick:re,size:"large",startIcon:f?s.jsx(Be,{color:F.white,size:24}):null,variant:"contained",children:"Save"})]})]})})})]})},mn=W(Fe)`
  && {
    color: ${F.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${F.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,gn=W(C)`
  font-size: 32px;
  color: ${F.white};
  cursor: pointer;
`,Me=W(C)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`;var bn=Object.defineProperty,xn=(t,o,i)=>o in t?bn(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,b=(t,o,i)=>(xn(t,typeof o!="symbol"?o+"":o,i),i);const ye=new Ht,mt=new Zt,yn=Math.cos(70*(Math.PI/180)),gt=(t,o)=>(t%o+o)%o;let wn=class extends Kt{constructor(o,i){super(),b(this,"object"),b(this,"domElement"),b(this,"enabled",!0),b(this,"target",new N),b(this,"minDistance",0),b(this,"maxDistance",1/0),b(this,"minZoom",0),b(this,"maxZoom",1/0),b(this,"minPolarAngle",0),b(this,"maxPolarAngle",Math.PI),b(this,"minAzimuthAngle",-1/0),b(this,"maxAzimuthAngle",1/0),b(this,"enableDamping",!1),b(this,"dampingFactor",.05),b(this,"enableZoom",!0),b(this,"zoomSpeed",1),b(this,"enableRotate",!0),b(this,"rotateSpeed",1),b(this,"enablePan",!0),b(this,"panSpeed",1),b(this,"screenSpacePanning",!0),b(this,"keyPanSpeed",7),b(this,"zoomToCursor",!1),b(this,"autoRotate",!1),b(this,"autoRotateSpeed",2),b(this,"reverseOrbit",!1),b(this,"reverseHorizontalOrbit",!1),b(this,"reverseVerticalOrbit",!1),b(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),b(this,"mouseButtons",{LEFT:ie.ROTATE,MIDDLE:ie.DOLLY,RIGHT:ie.PAN}),b(this,"touches",{ONE:ae.ROTATE,TWO:ae.DOLLY_PAN}),b(this,"target0"),b(this,"position0"),b(this,"zoom0"),b(this,"_domElementKeyEvents",null),b(this,"getPolarAngle"),b(this,"getAzimuthalAngle"),b(this,"setPolarAngle"),b(this,"setAzimuthalAngle"),b(this,"getDistance"),b(this,"listenToKeyEvents"),b(this,"stopListenToKeyEvents"),b(this,"saveState"),b(this,"reset"),b(this,"update"),b(this,"connect"),b(this,"dispose"),this.object=o,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>l.phi,this.getAzimuthalAngle=()=>l.theta,this.setPolarAngle=n=>{let d=gt(n,2*Math.PI),x=l.phi;x<0&&(x+=2*Math.PI),d<0&&(d+=2*Math.PI);let O=Math.abs(d-x);2*Math.PI-O<O&&(d<x?d+=2*Math.PI:x+=2*Math.PI),f.phi=d-x,e.update()},this.setAzimuthalAngle=n=>{let d=gt(n,2*Math.PI),x=l.theta;x<0&&(x+=2*Math.PI),d<0&&(d+=2*Math.PI);let O=Math.abs(d-x);2*Math.PI-O<O&&(d<x?d+=2*Math.PI:x+=2*Math.PI),f.theta=d-x,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=n=>{n.addEventListener("keydown",Ce),this._domElementKeyEvents=n},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Ce),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(a),e.update(),u=r.NONE},this.update=(()=>{const n=new N,d=new N(0,1,0),x=new it().setFromUnitVectors(o.up,d),O=x.clone().invert(),L=new N,K=new it,ee=2*Math.PI;return function(){const st=e.object.position;x.setFromUnitVectors(o.up,d),O.copy(x).invert(),n.copy(st).sub(e.target),n.applyQuaternion(x),l.setFromVector3(n),e.autoRotate&&u===r.NONE&&P(re()),e.enableDamping?(l.theta+=f.theta*e.dampingFactor,l.phi+=f.phi*e.dampingFactor):(l.theta+=f.theta,l.phi+=f.phi);let X=e.minAzimuthAngle,q=e.maxAzimuthAngle;isFinite(X)&&isFinite(q)&&(X<-Math.PI?X+=ee:X>Math.PI&&(X-=ee),q<-Math.PI?q+=ee:q>Math.PI&&(q-=ee),X<=q?l.theta=Math.max(X,Math.min(q,l.theta)):l.theta=l.theta>(X+q)/2?Math.max(X,l.theta):Math.min(q,l.theta)),l.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,l.phi)),l.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(j,e.dampingFactor):e.target.add(j),e.zoomToCursor&&I||e.object.isOrthographicCamera?l.radius=Ee(l.radius):l.radius=Ee(l.radius*h),n.setFromSpherical(l),n.applyQuaternion(O),st.copy(e.target).add(n),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,j.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),j.set(0,0,0));let me=!1;if(e.zoomToCursor&&I){let de=null;if(e.object instanceof be&&e.object.isPerspectiveCamera){const ue=n.length();de=Ee(ue*h);const ge=ue-de;e.object.position.addScaledVector(U,ge),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const ue=new N(D.x,D.y,0);ue.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),me=!0;const ge=new N(D.x,D.y,0);ge.unproject(e.object),e.object.position.sub(ge).add(ue),e.object.updateMatrixWorld(),de=n.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;de!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(de).add(e.object.position):(ye.origin.copy(e.object.position),ye.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(ye.direction))<yn?o.lookAt(e.target):(mt.setFromNormalAndCoplanarPoint(e.object.up,e.target),ye.intersectPlane(mt,e.target))))}else e.object instanceof xe&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),me=!0);return h=1,I=!1,me||L.distanceToSquared(e.object.position)>g||8*(1-K.dot(e.object.quaternion))>g?(e.dispatchEvent(a),L.copy(e.object.position),K.copy(e.object.quaternion),me=!1,!0):!1}})(),this.connect=n=>{n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=n,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",tt),e.domElement.addEventListener("pointerdown",Qe),e.domElement.addEventListener("pointercancel",Je),e.domElement.addEventListener("wheel",et)},this.dispose=()=>{var n,d,x,O,L,K;(n=e.domElement)==null||n.removeEventListener("contextmenu",tt),(d=e.domElement)==null||d.removeEventListener("pointerdown",Qe),(x=e.domElement)==null||x.removeEventListener("pointercancel",Je),(O=e.domElement)==null||O.removeEventListener("wheel",et),(L=e.domElement)==null||L.ownerDocument.removeEventListener("pointermove",ke),(K=e.domElement)==null||K.ownerDocument.removeEventListener("pointerup",Pe),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",Ce)};const e=this,a={type:"change"},c={type:"start"},p={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let u=r.NONE;const g=1e-6,l=new at,f=new at;let h=1;const j=new N,T=new H,m=new H,v=new H,w=new H,S=new H,R=new H,M=new H,k=new H,A=new H,U=new N,D=new H;let I=!1;const E=[],V={};function re(){return 2*Math.PI/60/60*e.autoRotateSpeed}function J(){return Math.pow(.95,e.zoomSpeed)}function P(n){e.reverseOrbit||e.reverseHorizontalOrbit?f.theta+=n:f.theta-=n}function $(n){e.reverseOrbit||e.reverseVerticalOrbit?f.phi+=n:f.phi-=n}const z=(()=>{const n=new N;return function(x,O){n.setFromMatrixColumn(O,0),n.multiplyScalar(-x),j.add(n)}})(),B=(()=>{const n=new N;return function(x,O){e.screenSpacePanning===!0?n.setFromMatrixColumn(O,1):(n.setFromMatrixColumn(O,0),n.crossVectors(e.object.up,n)),n.multiplyScalar(x),j.add(n)}})(),Z=(()=>{const n=new N;return function(x,O){const L=e.domElement;if(L&&e.object instanceof be&&e.object.isPerspectiveCamera){const K=e.object.position;n.copy(K).sub(e.target);let ee=n.length();ee*=Math.tan(e.object.fov/2*Math.PI/180),z(2*x*ee/L.clientHeight,e.object.matrix),B(2*O*ee/L.clientHeight,e.object.matrix)}else L&&e.object instanceof xe&&e.object.isOrthographicCamera?(z(x*(e.object.right-e.object.left)/e.object.zoom/L.clientWidth,e.object.matrix),B(O*(e.object.top-e.object.bottom)/e.object.zoom/L.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function G(n){e.object instanceof be&&e.object.isPerspectiveCamera||e.object instanceof xe&&e.object.isOrthographicCamera?h/=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function le(n){e.object instanceof be&&e.object.isPerspectiveCamera||e.object instanceof xe&&e.object.isOrthographicCamera?h*=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ye(n){if(!e.zoomToCursor||!e.domElement)return;I=!0;const d=e.domElement.getBoundingClientRect(),x=n.clientX-d.left,O=n.clientY-d.top,L=d.width,K=d.height;D.x=x/L*2-1,D.y=-(O/K)*2+1,U.set(D.x,D.y,1).unproject(e.object).sub(e.object.position).normalize()}function Ee(n){return Math.max(e.minDistance,Math.min(e.maxDistance,n))}function Ue(n){T.set(n.clientX,n.clientY)}function Pt(n){Ye(n),M.set(n.clientX,n.clientY)}function Ge(n){w.set(n.clientX,n.clientY)}function Ct(n){m.set(n.clientX,n.clientY),v.subVectors(m,T).multiplyScalar(e.rotateSpeed);const d=e.domElement;d&&(P(2*Math.PI*v.x/d.clientHeight),$(2*Math.PI*v.y/d.clientHeight)),T.copy(m),e.update()}function Tt(n){k.set(n.clientX,n.clientY),A.subVectors(k,M),A.y>0?G(J()):A.y<0&&le(J()),M.copy(k),e.update()}function Ot(n){S.set(n.clientX,n.clientY),R.subVectors(S,w).multiplyScalar(e.panSpeed),Z(R.x,R.y),w.copy(S),e.update()}function Mt(n){Ye(n),n.deltaY<0?le(J()):n.deltaY>0&&G(J()),e.update()}function $t(n){let d=!1;switch(n.code){case e.keys.UP:Z(0,e.keyPanSpeed),d=!0;break;case e.keys.BOTTOM:Z(0,-e.keyPanSpeed),d=!0;break;case e.keys.LEFT:Z(e.keyPanSpeed,0),d=!0;break;case e.keys.RIGHT:Z(-e.keyPanSpeed,0),d=!0;break}d&&(n.preventDefault(),e.update())}function We(){if(E.length==1)T.set(E[0].pageX,E[0].pageY);else{const n=.5*(E[0].pageX+E[1].pageX),d=.5*(E[0].pageY+E[1].pageY);T.set(n,d)}}function He(){if(E.length==1)w.set(E[0].pageX,E[0].pageY);else{const n=.5*(E[0].pageX+E[1].pageX),d=.5*(E[0].pageY+E[1].pageY);w.set(n,d)}}function Ze(){const n=E[0].pageX-E[1].pageX,d=E[0].pageY-E[1].pageY,x=Math.sqrt(n*n+d*d);M.set(0,x)}function Nt(){e.enableZoom&&Ze(),e.enablePan&&He()}function St(){e.enableZoom&&Ze(),e.enableRotate&&We()}function Ke(n){if(E.length==1)m.set(n.pageX,n.pageY);else{const x=Te(n),O=.5*(n.pageX+x.x),L=.5*(n.pageY+x.y);m.set(O,L)}v.subVectors(m,T).multiplyScalar(e.rotateSpeed);const d=e.domElement;d&&(P(2*Math.PI*v.x/d.clientHeight),$(2*Math.PI*v.y/d.clientHeight)),T.copy(m)}function Xe(n){if(E.length==1)S.set(n.pageX,n.pageY);else{const d=Te(n),x=.5*(n.pageX+d.x),O=.5*(n.pageY+d.y);S.set(x,O)}R.subVectors(S,w).multiplyScalar(e.panSpeed),Z(R.x,R.y),w.copy(S)}function qe(n){const d=Te(n),x=n.pageX-d.x,O=n.pageY-d.y,L=Math.sqrt(x*x+O*O);k.set(0,L),A.set(0,Math.pow(k.y/M.y,e.zoomSpeed)),G(A.y),M.copy(k)}function Dt(n){e.enableZoom&&qe(n),e.enablePan&&Xe(n)}function At(n){e.enableZoom&&qe(n),e.enableRotate&&Ke(n)}function Qe(n){var d,x;e.enabled!==!1&&(E.length===0&&((d=e.domElement)==null||d.ownerDocument.addEventListener("pointermove",ke),(x=e.domElement)==null||x.ownerDocument.addEventListener("pointerup",Pe)),zt(n),n.pointerType==="touch"?_t(n):Rt(n))}function ke(n){e.enabled!==!1&&(n.pointerType==="touch"?It(n):Lt(n))}function Pe(n){var d,x,O;ot(n),E.length===0&&((d=e.domElement)==null||d.releasePointerCapture(n.pointerId),(x=e.domElement)==null||x.ownerDocument.removeEventListener("pointermove",ke),(O=e.domElement)==null||O.ownerDocument.removeEventListener("pointerup",Pe)),e.dispatchEvent(p),u=r.NONE}function Je(n){ot(n)}function Rt(n){let d;switch(n.button){case 0:d=e.mouseButtons.LEFT;break;case 1:d=e.mouseButtons.MIDDLE;break;case 2:d=e.mouseButtons.RIGHT;break;default:d=-1}switch(d){case ie.DOLLY:if(e.enableZoom===!1)return;Pt(n),u=r.DOLLY;break;case ie.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(e.enablePan===!1)return;Ge(n),u=r.PAN}else{if(e.enableRotate===!1)return;Ue(n),u=r.ROTATE}break;case ie.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(e.enableRotate===!1)return;Ue(n),u=r.ROTATE}else{if(e.enablePan===!1)return;Ge(n),u=r.PAN}break;default:u=r.NONE}u!==r.NONE&&e.dispatchEvent(c)}function Lt(n){if(e.enabled!==!1)switch(u){case r.ROTATE:if(e.enableRotate===!1)return;Ct(n);break;case r.DOLLY:if(e.enableZoom===!1)return;Tt(n);break;case r.PAN:if(e.enablePan===!1)return;Ot(n);break}}function et(n){e.enabled===!1||e.enableZoom===!1||u!==r.NONE&&u!==r.ROTATE||(n.preventDefault(),e.dispatchEvent(c),Mt(n),e.dispatchEvent(p))}function Ce(n){e.enabled===!1||e.enablePan===!1||$t(n)}function _t(n){switch(nt(n),E.length){case 1:switch(e.touches.ONE){case ae.ROTATE:if(e.enableRotate===!1)return;We(),u=r.TOUCH_ROTATE;break;case ae.PAN:if(e.enablePan===!1)return;He(),u=r.TOUCH_PAN;break;default:u=r.NONE}break;case 2:switch(e.touches.TWO){case ae.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Nt(),u=r.TOUCH_DOLLY_PAN;break;case ae.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;St(),u=r.TOUCH_DOLLY_ROTATE;break;default:u=r.NONE}break;default:u=r.NONE}u!==r.NONE&&e.dispatchEvent(c)}function It(n){switch(nt(n),u){case r.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ke(n),e.update();break;case r.TOUCH_PAN:if(e.enablePan===!1)return;Xe(n),e.update();break;case r.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Dt(n),e.update();break;case r.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;At(n),e.update();break;default:u=r.NONE}}function tt(n){e.enabled!==!1&&n.preventDefault()}function zt(n){E.push(n)}function ot(n){delete V[n.pointerId];for(let d=0;d<E.length;d++)if(E[d].pointerId==n.pointerId){E.splice(d,1);return}}function nt(n){let d=V[n.pointerId];d===void 0&&(d=new H,V[n.pointerId]=d),d.set(n.pageX,n.pageY)}function Te(n){const d=n.pointerId===E[0].pointerId?E[1]:E[0];return V[d.pointerId]}i!==void 0&&this.connect(i),this.update()}};const vn=new N,jn=y.forwardRef(function({start:o=[0,0,0],end:i=[0,0,0],mid:e,segments:a=20,...c},p){const r=y.useRef(null),[u]=y.useState(()=>new Xt(void 0,void 0,void 0)),g=y.useCallback((f,h,j,T=20)=>(f instanceof N?u.v0.copy(f):u.v0.set(...f),h instanceof N?u.v2.copy(h):u.v2.set(...h),j instanceof N?u.v1.copy(j):u.v1.copy(u.v0.clone().add(u.v2.clone().sub(u.v0)).add(vn.set(0,u.v0.y-u.v2.y,0))),u.getPoints(T)),[]);y.useLayoutEffect(()=>{r.current.setPoints=(f,h,j)=>{const T=g(f,h,j);r.current.geometry&&r.current.geometry.setPositions(T.map(m=>m.toArray()).flat())}},[]);const l=y.useMemo(()=>g(o,i,e,a),[o,i,e,a]);return y.createElement(wo,_({ref:vo([r,p]),points:l},c))}),En=y.forwardRef(({makeDefault:t,camera:o,regress:i,domElement:e,enableDamping:a=!0,onChange:c,onStart:p,onEnd:r,...u},g)=>{const l=Q(k=>k.invalidate),f=Q(k=>k.camera),h=Q(k=>k.gl),j=Q(k=>k.events),T=Q(k=>k.setEvents),m=Q(k=>k.set),v=Q(k=>k.get),w=Q(k=>k.performance),S=o||f,R=e||j.connected||h.domElement,M=y.useMemo(()=>new wn(S),[S]);return je(()=>{M.enabled&&M.update()},-1),y.useEffect(()=>(M.connect(R),()=>void M.dispose()),[R,i,M,l]),y.useEffect(()=>{const k=D=>{l(),i&&w.regress(),c&&c(D)},A=D=>{p&&p(D)},U=D=>{r&&r(D)};return M.addEventListener("change",k),M.addEventListener("start",A),M.addEventListener("end",U),()=>{M.removeEventListener("start",A),M.removeEventListener("end",U),M.removeEventListener("change",k)}},[c,p,r,M,l,T]),y.useEffect(()=>{if(t){const k=v().controls;return m({controls:M}),()=>m({controls:k})}},[t,M]),y.createElement("primitive",_({ref:g,object:M,enableDamping:a},u))});function kn(t){const o=t+"Geometry";return y.forwardRef(({args:i,children:e,...a},c)=>y.createElement("mesh",_({ref:c},a),y.createElement(o,{attach:"geometry",args:i}),e))}const Pn=kn("circle"),bt=t=>{const o=y.useRef();return y.useEffect(()=>{o.current=t}),o.current},Ve=10,Cn=2,xt=2,Tn=(t,o,i)=>{const c=new N().subVectors(o,t).normalize().multiplyScalar(i);return new N().addVectors(t,c)},Et=({links:t,nodes:o})=>{const i=y.useRef(null);return je(()=>{i.current&&o&&i.current.children.forEach((e,a)=>{var m;const c=t[a];if(!c)return;const p=o.find(v=>v.ref_id===c.source),r=o.find(v=>v.ref_id===c.target),u=new N((r==null?void 0:r.x)||0,(r==null?void 0:r.y)||0,(r==null?void 0:r.z)||0),g=new N((p==null?void 0:p.x)||0,(p==null?void 0:p.y)||0,(p==null?void 0:p.z)||0),l=Tn(g,u,Ve+xt),f=u.clone(),h=new N().lerpVectors(f,l,0),j=e.children[0],T=e.children[1];T.position.set(l.x,l.y,l.z),T.lookAt(f),T.rotateX(-Math.PI/2),(m=j.setPoints)==null||m.call(j,f,l,h)})}),s.jsx("group",{ref:i,children:t.map(e=>s.jsxs("group",{children:[s.jsx(jn,{color:"white",end:[0,0,0],lineWidth:2,start:[0,0,0]}),s.jsxs("mesh",{position:new N(0,0,0),children:[s.jsx("coneGeometry",{args:[Cn,xt,32]}),s.jsx("meshBasicMaterial",{color:"white"})]})]},e.ref_id))})};Et.displayName="Lines";const On=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"];new qt(2,2,2);const kt=y.memo(({node:t,setSelectedNode:o,onSimulationUpdate:i,isSelected:e})=>{var l;const a=y.useRef(null);console.log(e);const{size:c,camera:p}=Q(),r=uo(f=>{const{xy:[h,j],down:T,dragging:m,first:v,elapsedTime:w}=f;if(!(!m||v||w<100)&&T&&a.current){i();const S=(h-c.left)/window.innerWidth*c.width,R=(j-c.top)/window.innerHeight*c.height,A=new N(S/c.width*2-1,-R/c.height*2+1,0).unproject(p).multiply(new N(1,1,0)).clone();t.fx=A.x,t.fy=A.y}});je(()=>{a.current&&a.current.position.set(t.x||0,t.y||0,0)});const u=On[(l=t==null?void 0:t.children)==null?void 0:l.length]||"red",g=f=>{f.stopPropagation(),o()};return s.jsxs("mesh",{ref:a,onClick:g,...r(),position:new N(t.x,t.y,0),children:[s.jsx(Pn,{args:[Ve,30,20],children:s.jsx("meshStandardMaterial",{attach:"material",color:u})}),s.jsx(jo,{...ko,color:"#000",fontSize:2,children:t.type})]})});kt.displayName="Node";const Mn=({simulation:t,setSelectedSchemaId:o,selectedId:i})=>{const[e]=jt(c=>[c.schemas]),a=()=>{t&&(t.alpha(.05),t.restart())};return s.jsx(s.Fragment,{children:e.map((c,p)=>{const r=t.nodes()[p];return r?s.jsx(kt,{isSelected:r.ref_id===i,node:r,onSimulationUpdate:a,setSelectedNode:()=>o(r.ref_id)},r.ref_id):null})})},$n=({schemasWithPositions:t,filteredLinks:o,setSelectedSchemaId:i,selectedSchemaId:e})=>{const[a,c]=y.useState(null),p=bt(t),r=bt(o);return y.useEffect(()=>{if(!t.length||!o.length)return;const u=structuredClone(t),g=structuredClone(o);if(a){p&&p.length!==t.length&&r&&r.length!==o.length&&(a.nodes(u).force("link",ct(g).id(f=>f.ref_id)).force("charge",lt()).force("center",dt()).force("collide",ut(Ve+1)).alpha(.5).restart(),c({...a}));return}const l=Qt(u).force("link",ct(g).id(f=>f.ref_id)).force("charge",lt()).force("center",dt()).force("collide",ut(0));c(l)},[t,a,o,p,r]),je(()=>{}),a?s.jsxs(s.Fragment,{children:[s.jsx(Et,{links:o,nodes:a.nodes()}),s.jsx(Mn,{selectedId:e,setSelectedSchemaId:i,simulation:a})]}):null},$e=new Jt(0),Nn=({selectedSchemaId:t,links:o,schemasWithPositions:i,setSelectedSchemaId:e})=>s.jsxs(Eo,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[s.jsx("color",{args:[$e.r,$e.g,$e.b],attach:"background"}),eo&&s.jsx(Po,{position:"right-bottom"}),s.jsx(En,{enableRotate:!1,enableZoom:!0}),s.jsx(Co,{}),s.jsx($n,{filteredLinks:o,schemasWithPositions:i,selectedSchemaId:t,setSelectedSchemaId:e})]}),Sn=({onCreateNew:t})=>s.jsxs(Dn,{children:[s.jsx(Rn,{children:"BLUEPRINT"}),s.jsxs(An,{"data-testid":"add-schema-type",onClick:t,children:[s.jsx(Ln,{children:s.jsx(To,{})}),s.jsx(te,{children:"Add Type"})]})]}),Dn=W(C).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1 1 auto;
  z-index: 31;
  transition: opacity 1s;
  background: ${F.BG2};
  overflow: hidden;
  max-height: 100vh;

  @media (max-width: 1440px) {
    max-height: 95.2vh;
  }

  @media (max-width: 1024px) {
    max-height: 74.8vh;
  }

  @media (max-width: 924px) {
    max-height: 73.1vh;
  }
`,An=W(C).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 64px;
  height: 58px;
  padding: 0;
  flex-direction: row;
  color: ${F.GRAY6};
  cursor: pointer;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px; /* Initial width */
    height: 32px; /* Initial height on hover */
    background-color: transparent;
    transition: height 0.3s, width 0.3s, background-color 0.3s;
  }

  ${te} {
    display: none;
    opacity: 0;
    width: 0;
    padding: 4px 10px;
    border-radius: 4px;
    background: #000;
    box-shadow: 0px 4px 8px 0px rgba(0, 0, 0, 0.25);
    position: absolute;
    left: 90%;
    z-index: 99;
    white-space: nowrap;
    visibility: visible;
    font-size: 11px;
    font-style: normal;
    font-weight: 400;
    transition: ${({theme:t})=>t.transitions.create(["opacity","visually"])};
  }

  &:hover {
    color: ${F.white};

    &:before {
      width: 3px;
      height: 32px;
      background-color: ${F.primaryBlue};
    }

    ${te} {
      display: block;
      width: min-content;
      opacity: 1;
      visibility: visible;
    }
  }

  &:active {
    color: ${F.white};
    background: ${F.black};
    &:before {
      width: 3px;
      height: 100%;
      background-color: ${F.primaryBlue};
    }
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,Rn=W(C)`
  background: blue;
  align-items: center;
  justify-content: center;
  background: ${F.primaryBlue};
  width: 64px;
  height: 64px;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: ${F.white};
`,Ln=W(C)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,_n=()=>{const[t,o]=y.useState(""),[i,e]=y.useState(!1),[a,c]=y.useState(!1),[p,r,u,g]=jt(m=>[m.schemas,m.links,m.setSchemas,m.setSchemaLinks]);y.useEffect(()=>{(async()=>{c(!0);try{const v=await to();u(v.schemas.filter(w=>w.ref_id&&!w.is_deleted&&w.ref_id)),g(v.edges),c(!1)}catch(v){console.error("Error fetching data:",v),c(!1)}})()},[u,g]);const l=m=>{if(p.some(w=>w.ref_id===m.ref_id))u(p.map(w=>w.ref_id===m.ref_id?{...m,children:[]}:w));else{u([...p,{...m,children:[]}]);const w=p.find(S=>m.parent===S.type);g([...r,{ref_id:`new-link-${r.length}`,edge_type:"CHILD_OF",source:m.ref_id||"new",target:(w==null?void 0:w.ref_id)||"new"}])}},f=m=>{u(p.filter(v=>v.type!==m))},h=p.map(m=>({...m,children:p.filter(v=>v.parent===m.type).map(v=>v.ref_id||"")})),j=r.filter(m=>m.edge_type==="CHILD_OF"&&h.some(v=>v.ref_id===m.source)&&h.some(v=>v.ref_id===m.target)),T=p.find(m=>m.ref_id===t)||null;return a?s.jsx(C,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:s.jsx(Be,{color:F.white})}):s.jsx(s.Fragment,{children:s.jsxs(C,{align:"stretch",direction:"row",grow:1,children:[s.jsx(C,{ml:-20,my:-20,children:s.jsx(Sn,{onCreateNew:()=>{e(!0),o("")}})}),s.jsx(C,{children:T||i?s.jsx(zn,{children:s.jsx(hn,{onDelete:f,onSchemaCreate:l,selectedSchema:T,setIsCreateNew:e,setSelectedSchemaId:o})}):null}),s.jsx(In,{direction:"row",grow:1,children:s.jsx(Bn,{children:s.jsx(Nn,{links:j,schemasWithPositions:h,selectedSchemaId:t,setSelectedSchemaId:o})})})]})})},In=W(C)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  padding: 10px;
  max-height: 80vh;

  @media (max-width: 1440px) {
    max-height: 85vh;
  }

  @media (max-width: 1024px) {
    max-height: 70vh;
  }
`,zn=W(C)`
  width: 100%;
  max-width: 400px;
  background: ${F.BG1};
  padding: 16px;
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: auto;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Bn=W(C)`
  flex: 1 1 100%;
`,Fn=()=>{const{close:t}=wt("blueprintGraph"),o=()=>{t()};return s.jsx(oo,{background:"black",id:"blueprintGraph",kind:"full",onClose:o,preventOutsideClose:!0,children:s.jsx(_n,{})})},ps=y.memo(Fn);export{ps as BlueprintModal};
